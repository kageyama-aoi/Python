# 画面操作自動化ツール 学習教材 & 問題集

このドキュメントは、リファクタリングされた自動化ツールのコードベースを理解するためのガイドです。
Pythonの基礎知識に加え、設計パターンや実践的なテクニックを学ぶことを目的としています。

---

## 1. プロジェクト全体像 (Architecture)

このツールは「設定（データ）」と「処理（ロジック）」を分離する設計（**Separation of Concerns**）を採用しています。

### ファイル構成と役割

| ファイル名 | 役割 | 例え |
| :--- | :--- | :--- |
| `main.py` | **司令塔**。全体の流れを制御し、各部品を繋ぎ合わせます。 | 現場監督 |
| `config.yaml` | **設計図**。URL、入力項目、各学校のデフォルト値などのデータ。 | 仕様書 |
| `src/config.py` | **翻訳機**。YAMLファイルを読み込み、Pythonが扱える辞書オブジェクトに変換して提供します。 | 資料係 |
| `src/form_handler.py` | **作業員**。設計図(`config`)に従って、具体的な入力作業の手順を組み立てます。 | オペレーター |
| `src/browser_utils.py` | **道具箱**。Seleniumの操作（クリック、入力など）を使いやすくラップした関数群。 | ドライバー/レンチ |

### 処理の流れ

1.  `main.py` が起動。
2.  `config.py` が `config.yaml` を読み込む。
3.  `main.py` がユーザーに入力を求める（学校選択など）。
4.  `main.py` がブラウザ(`driver`)を起動する。
5.  `main.py` が `FormAutomationHandler` を作成し、仕事(`driver`と設定)を依頼する。
6.  `FormAutomationHandler` が `config` のデータとユーザー入力を組み合わせて、ブラウザを操作する。

---

## 2. 重要な技術コンセプト

### A. データドリブン (Data-Driven)
ロジック（コード）の中に具体的な値（学校名やIDなど）を書かず、外部データ(`config.yaml`)に追い出す手法です。
*   **メリット**: 新しい学校を追加する際、Pythonコードを一切触らずにYAMLを編集するだけで済みます。

### B. 辞書のマージ (Dictionary Merging)
`form_handler.py` で行っている「共通設定」と「個別設定」の統合テクニックです。

```python
# 共通設定 (Common)
merged = {'A': 1, 'B': 2}

# 個別設定 (Specific)
specific = {'B': 99, 'C': 3}

# マージ (Update)
merged.update(specific)
# 結果: {'A': 1, 'B': 99, 'C': 3} -> Bは上書きされ、Cは追加される
```
これにより、「基本はこれだけど、ここだけ変えたい」という差分定義が可能になります。

### C. *args (可変長引数) のアンパック
`browser_utils.input_text(*common_dom_args)` の `*` は、タプルの中身を展開して引数として渡す機能です。
毎回 `(driver, 'name', locator, value)` と書くのが大変なため、タプルにまとめて渡しています。

---

## 3. 問題集 (Quiz)

コードの理解度を試す問題集です。

### Level 1: 初級 (構成と基本)

**Q1. このツールのエントリーポイント（最初に実行するファイル）はどれですか？**
A. `src/config.py`
B. `src/form_handler.py`
C. `src/main.py`
D. `config.yaml`

**Q2. 新しい学校「NewSchool」を追加したい場合、どのファイルを編集すべきですか？**
A. `src/main.py` に `if school == "NewSchool"` を追加する。
B. `config.yaml` の `school_specific_defaults` に設定を追加する。
C. `src/form_handler.py` に新しいメソッドを作る。

**Q3. `src/browser_utils.py` の役割として最も適切なものは？**
A. 設定ファイルを読み込む。
B. Seleniumの基本操作を関数としてまとめる。
C. ユーザーからの入力を受け付ける。

---

### Level 2: 中級 (ロジックの理解)

**Q4. `src/config.py` 内の `load_config` 関数は何をしていますか？**
A. ログファイルを作成している。
B. YAMLファイルを読み込み、グローバル変数 `CONF` に辞書として保存している。
C. ブラウザを起動している。

**Q5. `form_handler.py` の `fill_form` メソッドで、以下のコードは何を実現していますか？**
```python
merged_settings = conf.CONF['common_defaults'].copy()
specific_settings = conf.CONF['school_specific_defaults'].get(self.schools_type, {})
merged_settings.update(specific_settings)
```
A. 設定ファイルのバックアップを作成している。
B. 全ての学校の設定を削除している。
C. 共通のデフォルト設定に対し、選択された学校固有の設定を上書き（マージ）している。

---

### Level 3: 上級 (応用と拡張)

**Q6. YAMLファイル内で改行を含む文章（メール本文など）を定義するために使われている記号は？**
A. `>`
B. `|`
C. `\n`

**Q7. 現在は「テキスト入力」と「セレクトボックス選択」しかできません。もし「チェックボックス」の操作を追加したい場合、最低限どのファイルの修正が必要ですか？（2つ選択）**
A. `src/main.py`
B. `src/browser_utils.py` (チェックボックス操作関数の追加)
C. `src/form_handler.py` (typeがcheckboxの場合の分岐追加)
D. `src/config.py`

---

## 解答と解説

**Level 1**
*   Q1: **C** (`src/main.py` が司令塔です)
*   Q2: **B** (データドリブンなのでYAMLの編集だけで済みます)
*   Q3: **B** (具体的なSeleniumの記述はここに隠蔽されています)

**Level 2**
*   Q4: **B** (`PyYAML`を使って辞書化しています)
*   Q5: **C** (これがこのツールの設定管理の肝となるロジックです)

**Level 3**
*   Q6: **B** (YAMLのパイプ `|` は改行を維持したブロックリテラルです)
*   Q7: **B と C**
    1.  `config.yaml` に `type: checkbox` の項目を追加（設問にはないが前提）。
    2.  `browser_utils.py` に `check_box(driver, ...)` のような関数を作る。
    3.  `form_handler.py` の `if val["type"] == ...` の分岐に `checkbox` 用の処理を追加し、先ほどの関数を呼ぶ。

```