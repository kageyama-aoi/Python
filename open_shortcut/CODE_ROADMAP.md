# コード理解のためのロードマップ

このドキュメントは、`open_shortcut` プロジェクトのコード全体の流れを理解するためのロードマップです。
コードが複雑になってくると、全体像を俯瞰できる地図のようなものが必要になります。ここでは、静的な構造を理解するための図と、動的な処理の流れを理解するための図を組み合わせることで、プロジェクトの全体像を把握します。

## 1. Mermaidによるコードの可視化

Mermaid は、テキストから図を生成するためのツールです。これを使うことで、コードの構造や処理の流れを視覚的に理解できます。

### ① クラス関連図 (静的な構造の理解)

まず、このプロジェクトにどのような「登場人物（クラス）」がいて、それらがどのように関係しているのかを把握しましょう。クラス図を使うと、プロジェクトの骨格を理解できます。

**目的:**
主要なクラス間の生成・利用関係を把握し、プロジェクト全体の構成を理解する。

> この図のソースコードは `docs/diagrams/class_diagram.md` で管理しています。

**この図から分かること:**
*   `run.bat` が起点となり `main.py` を実行します。
*   アプリケーションの中心は `DirectoryOpenerApp` クラスです。
*   `DirectoryOpenerApp` が `SettingsEditor` を生成し、`SettingsEditor` はさらに `ParameterEditor` を生成するという階層構造になっています。
*   各クラスが `constants.py` を利用して、設定キーなどの文字列を安全に扱っていることが分かります。

---

### ② アプリケーション起動シーケンス図 (動的な処理の理解)

次に、ユーザーが `run.bat` を実行してから、GUIが表示されるまでの「一連の流れ」を見てみましょう。シーケンス図は、このような時系列の処理を理解するのに非常に役立ちます。

**目的:**
アプリケーションが起動し、`config.json` を読み込んでUIを構築するまでの一連のメソッド呼び出しの流れを追跡する。

> この図のソースコードは `docs/diagrams/startup_sequence.md` で管理しています。

**この図から分かること:**
*   `__init__` の中で、設定の読み込み (`_load_config`) からウィジェットの作成 (`_create_widgets`) までが一貫して行われていることが分かります。
*   `_create_widgets` -> `_populate_page` -> `_create_button` というように、UIが階層的に構築されていく様子が明確になります。

---

### ③ 設定保存とUIリロードのシーケンス図 (動的な処理の理解)

最近実装した「動的リロード」のように、複数のクラスが連携する複雑な処理も、シーケンス図で可視化すると非常に分かりやすくなります。

**目的:**
設定エディタでの保存が、コールバック関数を通じてメインアプリのUIリロードをトリガーする仕組みを理解する。

> この図のソースコードは `docs/diagrams/reload_sequence.md` で管理しています。

**この図から分かること:**
*   `DirectoryOpenerApp` が `SettingsEditor` に `reload_ui` という「未来の約束（コールバック）」を渡していることが一目瞭然です。
*   `SettingsEditor` は、自分を呼び出したのが誰かを知らなくても、ただ約束通りコールバックを実行するだけで、結果的に `DirectoryOpenerApp` のUIが更新されるという、疎結合な設計になっていることが理解できます。

## 2. デバッガによる動的な追跡 (補完的な方法)

Mermaidの図は素晴らしい「静的な地図」ですが、実際にコードがどのように動くかを体験するには、**デバッガを使ったステップ実行**が最も効果的です。

**目的:**
コードの実行を一行ずつ追いながら、変数の値がどのように変化し、どの条件分岐に入るかをリアルタイムで確認する。

**具体的な方法 (VSCodeの場合):**

1.  **ブレークポイントの設定**:
    *   `src/main.py` を開き、`__init__` メソッドの最初の行（`self.master = master`）の行番号の左側をクリックして、赤い丸（ブレークポイント）を付けます。
    *   同様に、`_create_button` メソッドの最初の行にもブレークポイントを付けます。
2.  **デバッグの開始**:
    *   VSCodeの左側のアクティビティバーから「実行とデバッグ」アイコン（虫のマークの付いた再生ボタン）を選択します。
    *   上部の「実行とデバッグ」ボタン（緑の再生ボタン）を押します。Pythonのデバッグ構成が自動で選択され、デバッグが開始されます。
3.  **ステップ実行**:
    *   プログラムは最初に設定したブレークポイントで一時停止します。
    *   画面上部に表示されるデバッグツールバーのボタンを使って、処理を進めます。
        *   **ステップオーバー (F10)**: 現在の行を実行し、次の行へ進みます（メソッドの中には入らない）。
        *   **ステップイン (F11)**: メソッド呼び出しがある行で使うと、そのメソッドの中に入って処理を追います。
        *   **続行 (F5)**: 次のブレークポイントまで一気に実行します。
    *   左側の「変数」パネルで、`self.config` などの変数の内容がリアルタイムで確認できます。

## まとめ: コード理解の進め方

以上の方法を組み合わせることで、効果的にコードを理解できます。

1.  **森を見る (全体像の把握)**:
    *   まず「**クラス関連図**」を見て、プロジェクトの全体構成と主要な登場人物を把握します。
2.  **木の幹をたどる (主要な流れの理解)**:
    *   次に「**起動シーケンス図**」や「**設定保存シーケンス図**」を見て、主要な機能がどのような順序で実行されるかを理解します。
3.  **枝葉を調べる (詳細な動きの確認)**:
    *   特定のメソッドの細かい動きや、変数の変化が気になったら、「**デバッガ**」を使って実際にコードを動かしながら確認します。

このロードマップに沿って進めることで、コード全体の流れを深く、そして正確に理解することができるはずです。