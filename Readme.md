 工数集計ツール

## 概要

このツールは、勤怠管理システム(CrowdLog)からエクスポートした工数実績のCSVファイルを元に、プロジェクト別・担当者別に工数を集計し、整形されたExcelファイルを出力します。
編集1編集1w


## ディレクトリ構成

```
工数集計/
├── .vscode/
│   └── launch.json       # VSCodeのデバッグ設定
├── code/
│   └── summary_kousuu_2024_1106.py # (旧)メイン処理スクリプト
├── error_log/              # (生成される) エラーログ格納フォルダ
├── input/
│   ├── timesheet.csv       # 工数実績データ (CrowdLogからDL)
│   ├── bugs.csv            # TR/Bug情報データ (スプレッドシートからDL)
│   ├── 01.crowdlogへ.url   # CrowdLogダウンロードページへのショートカット
│   └── 02.file_gone.bat    # DLしたCSVをリネーム・移動するバッチ
├── output/                 # (生成される) 出力Excelファイル格納フォルダ
├── 03_click_this_kensho.bat # メイン実行用バッチファイル
├── config.json             # フィルタリング条件などの設定ファイル
├── summary_kousuu_2025_0227.py # (旧)メイン処理スクリプト
├── summary_kousuu_2025_0303.py # (新)メイン処理スクリプト
└── readme.md               # このファイル
```

## 必要なもの

- Python 3.x

### Pythonライブラリ

以下のライブラリが必要です。`pip`でインストールしてください。

```bash
pip install pandas openpyxl xlsxwriter
```

## 使い方

### 1. データ準備

1.  `input/01.crowdlogへ.url` をダブルクリックしてCrowdLogを開き、工数実績データをCSV形式でダウンロードします。
2.  ダウンロードしたCSVファイル（例: `timesheet_20240101_20240131.csv`）を `Downloads` フォルダに保存します。
3.  `input/02.file_gone.bat` を実行します。最新の工数実績CSVが自動で `input/timesheet.csv` としてコピー＆リネームされます。
4.  必要に応じて `input/bugs.csv` の内容を更新します。（`input/スプシ.url` のショートカットからGoogleスプレッドシートを開き、手動でエクスポート）

### 2. 集計条件の設定

`config.json` ファイルをテキストエディタで開き、集計したい条件を設定します。

```json
{
    "notes": {
      "project_patterns": ["社内ダミー", "島村楽器", ""],
      "employee_patterns": ["景山 朋美", "佐藤花子", "全社員"]
    },
    "target_project": "社内ダミー",
    "target_employee": "景山 朋美"
}
```

- **target_project**:
  - 集計したいプロジェクト名（取引先名）を指定します。
  - 空文字列 `""` にすると、全てのプロジェクトが対象になります。
- **target_employee**:
  - 集計したい社員名を指定します。
  - 空文字列 `""` にすると、全ての社員が対象になります。

### 3. ツールの実行

`03_click_this_kensho.bat` をダブルクリックして実行します。

### 4. 結果の確認

- 正常に処理が完了すると、`output` フォルダに結果のExcelファイルが生成されます。
  - 例: `temp2_社内ダミー_景山 朋美_aggregate_results.xlsx`
- 処理中にエラーが発生した場合は、`error_log` フォルダにエラー内容が記載されたテキストファイルが生成されます。

## 各ファイルの説明

| ファイル/フォルダ             | 説明                                                                                                                                                           |
| ----------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `03_click_this_kensho.bat`    | **このツールを実行するためのメインファイルです。**（内部で `main.py` を呼び出します）                                                                          |
| `config.json`                 | 集計対象のプロジェクトや担当者を指定する設定ファイルです。                                                                                                   |
| `main.py`                     | データ集計とExcel出力を実行するPythonスクリプト本体です。                                                                                                      |
| `input/`                      | `timesheet.csv` や `bugs.csv` などの入力ファイルを格納するフォルダです。                                                                                       |
| `output/`                     | 集計結果のExcelファイルが保存されるフォルダです。（初回実行時に自動生成されます）                                                                             |
| `error_log/`                  | 実行時エラーが発生した場合にログファイルが保存されるフォルダです。（初回実行時に自動生成されます）                                                               |
| `input/02.file_gone.bat`      | ダウンロードフォルダから最新の `timesheet_*.csv` を `input/timesheet.csv` にリネーム/コピーするための補助バッチです。                                            |
| `*.url`                       | データ取得元のWebページへのショートカットです。                                                                                                                |

## 今後の改善案

- **スクリプトのリファクタリング**: `main.py`内の各関数（データ加工、Excel整形など）を、より責務が明確になるように分割・整理する。
- **設定の柔軟性向上**: `config.json` で複数のプロジェクトや担当者をリスト形式で指定できるようにスクリプトを修正する。
