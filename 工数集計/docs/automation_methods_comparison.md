# 勤怠データ自動同期・更新機能の実装手法比較

`docs/指示だし.md` の要望に基づき、外部プロジェクト（勤怠自動化）のデータを連携・更新するための実装手法を比較・提案します。

## 要件
1. `01_勤怠自動化` のダウンロードフォルダから最新の `timesheet_*.csv` を取得する。
2. 必要に応じて `run_validation.bat` を実行し、データを再生成（更新）させるオプションを提供する。

## 実装手法の案

### 案1: 対話型プロンプト（Interactive Prompt） **【採用推奨】**
実行時にユーザーに確認を求める方法です。

- **動作**: スクリプト起動時に「最新データを取得し直しますか？ (y/n)」と表示し、入力に応じて処理を分岐。
- **メリット**:
    - 意図しないバッチ実行（時間がかかる処理など）を防げる。
    - 特別なコマンド引数を覚える必要がない。
- **デメリット**:
    - 完全自動化（タスクスケジューラ等での実行）の際に、入力待ちで止まってしまう（対策：引数がない場合のみ聞く等のロジックが必要）。

### 案2: コマンドライン引数（Command Line Arguments）
起動時の引数で制御する方法です。例: `python main.py --refresh`

- **動作**: 引数がある場合のみバッチを実行。デフォルトは既存ファイルを使用。
- **メリット**:
    - 慣れているユーザーには高速。
    - バッチファイルやシェルスクリプトに組み込みやすい。
- **デメリット**:
    - 引数を忘れると古いデータのまま集計してしまう可能性がある。
    - `argparse` 等の実装が必要。

### 案3: 設定ファイル（Config File）
`config.json` に設定を持たせる方法です。

- **動作**: `config.json` に `"auto_refresh_data": true` などを記述。
- **メリット**:
    - 毎回同じ動作をさせたい場合に便利。
- **デメリット**:
    - その都度動作を変えたい場合、ファイルを編集する手間が発生する。

### 案4: 常に実行（Always Run）
確認せず毎回バッチを実行する方法です。

- **動作**: 起動時に無条件でバッチを実行し、最新ファイルをコピー。
- **メリット**:
    - 常に最新データが保証される。
    - 操作が最もシンプル。
- **デメリット**:
    - バッチの実行時間が長い場合、毎回待たされることになる。
    - 外部システムへの負荷が懸念される場合がある。

## 推奨される実装方針（案1 + α）

現状の運用フローを考慮すると、**案1（対話型）** が最も安全で使いやすいと考えられます。
ただし、将来的な自動化を見据えて、以下のようなハイブリッド実装にしておくと柔軟性が高まります。

1.  コマンドライン引数 (`--yes` や `--refresh`) があれば、確認なしで実行。
2.  引数がなければ、ユーザーに入力 (`y/n`) を求める。

## 具体的な処理フロー

1.  **開始**: `main.py` 起動
2.  **確認**: 更新オプションが指定されているか？ またはユーザーが `y` と答えたか？
    *   **Yes**:
        1.  `subprocess.run` で `../01_勤怠自動化/scripts/run_validation.bat` を実行。
        2.  エラーハンドリング（バッチ失敗時は停止または警告）。
3.  **同期**: `../01_勤怠自動化/data/downloads` を走査。
    *   ファイル名 `timesheet_*.csv` かつ 更新日時が最新 のファイルを特定。
    *   `input/timesheet.csv` へコピー。
4.  **集計**: 既存の集計ロジックを実行。

この方針で実装・設計を行います。
