# 機能追加：最新タイムシート取得およびデータ更新機能の設計

## 1. 目的
「01_勤怠自動化」プロジェクトで生成された最新のタイムシートデータを、「工数集計」プロジェクトの入力データとして自動的に取り込み、必要に応じてデータを最新化する仕組みを構築します。

## 2. 提案手法

### 2.1 最新ファイルの特定とコピー
別プロジェクトのダウンロードフォルダから最新のファイルを取得します。

- **対象パス**: `C:\Users\kageyama\Tools\Python\01_勤怠自動化\data\downloads`
- **対象ファイル**: `timesheet_*.csv`
- **選定基準**: ファイルの更新日時（Timestamp）が最も新しいもの。
- **実装方法**:
    - `pathlib` と `glob` を使用してファイル一覧を取得。
    - `os.path.getmtime` または `stat().st_mtime` でソート。
    - `shutil.copy2` を使用して `input/timesheet.csv` に上書きコピー。

### 2.2 データの再生成オプション（外部バッチ実行）
集計実行前に、元となるデータを最新化するかどうかを選択可能にします。

- **対象バッチ**: `C:\Users\kageyama\Tools\Python\01_勤怠自動化\scripts\run_validation.bat`
- **実装方法**:
    - `main.py` の開始時にコンソールで「最新データを取得し直しますか？ (y/n)」とプロンプトを表示。
    - 「y」の場合、`subprocess.run()` を使用して上記バッチファイルを呼び出し。
    - バッチ終了後、2.1のコピー処理を実行。

## 3. コード構成の変更案

### 3.1 `src/config.py`
外部プロジェクトのパスを定数として追加します。
- `EXTERNAL_DOWNLOAD_DIR`: ダウンロードフォルダのパス
- `EXTERNAL_REFRESH_BAT`: 更新用バッチファイルのパス

### 3.2 `src/data_loader.py`
ファイルコピーとバッチ実行のロジックを関数として追加します。
- `sync_latest_timesheet()`: ファイル選定とコピーを担当
- `refresh_external_data()`: バッチ実行を担当

### 3.3 `main.py`
全体のフローの先頭に、更新確認と同期処理を組み込みます。

## 4. メリット
- 手動でのファイル移動ミスがなくなります。
- 常に最新のデータに基づいて集計が行われることが保証されます。
- 既存の勤怠自動化ツールとの連携がスムーズになります。
