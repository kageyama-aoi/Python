<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>Data Flow Portal</title>
  <link rel="stylesheet" href="assets/style.css">
  <style>
    table { border-collapse: collapse; }
    th, td { border: 1px solid #cbd5e1; padding: 6px 8px; }
  </style>
</head>
<body>
  <div class="portal-container">
    <h1>Data Flow Portal</h1>
    <div class="meta">Generated: 2026-02-03 13:47:09 | Input: data_flow_dummy_alt.csv</div>
    <div class="controls">
      <label for="tableFilter">テーブル絞り込み:</label>
      <select id='tableFilter'><option value=''>すべて</option><option value='products'>products</option><option value='shipments'>shipments</option><option value='subscriptions'>subscriptions</option></select>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr><th class='group-header sticky-top-1 sticky-col' style='left: 0px; min-width: 540px; max-width: 540px;' colspan='4'>対象・フロー（固定）</th><th id='changeGroupHeader' class='group-header sticky-top-1' data-count='10' colspan='10'><div class='group-title'>変更カラム（イベント内の更新）
            <div class="legend inline">
              <span class="badge added">added</span>
              <span class="badge removed">removed</span>
              <span class="badge changed">changed</span>
              <span class="badge same">same</span>
            </div>
            </div></th></tr>
          <tr><th class='sticky-top-2 group-header sticky-col' style='left: 0px; min-width: 540px; max-width: 540px;' colspan='4'></th><th class='sticky-top-2 group-header' data-group='products' data-count='4' colspan='4'>products</th><th class='sticky-top-2 group-header' data-group='shipments' data-count='3' colspan='3'>shipments</th><th class='sticky-top-2 group-header' data-group='subscriptions' data-count='3' colspan='3'>subscriptions</th></tr>
          <tr><th class='sticky-col sticky-top-3' style='left: 0px; width: 140px; min-width: 140px; max-width: 140px;'>case_id</th><th class='sticky-col sticky-top-3' style='left: 140px; width: 140px; min-width: 140px; max-width: 140px;'>table</th><th class='sticky-col sticky-top-3' style='left: 280px; width: 110px; min-width: 110px; max-width: 110px;'>operation</th><th class='sticky-col sticky-top-3' style='left: 390px; width: 150px; min-width: 150px; max-width: 150px;'>trigger</th><th class='sticky-top-3' data-group='products'>product_name</th><th class='sticky-top-3' data-group='products'>price</th><th class='sticky-top-3' data-group='products'>stock</th><th class='sticky-top-3' data-group='products'>deleted_flag</th><th class='sticky-top-3' data-group='shipments'>shipment_status</th><th class='sticky-top-3' data-group='shipments'>shipped_at</th><th class='sticky-top-3' data-group='shipments'>delay_reason</th><th class='sticky-top-3' data-group='subscriptions'>plan_code</th><th class='sticky-top-3' data-group='subscriptions'>renewed_at</th><th class='sticky-top-3' data-group='subscriptions'>next_billing</th></tr>
        </thead>
        <tbody>
          <tr class='op-insert' data-table='products'><td class='sticky-col' style='left: 0px; width: 140px; min-width: 140px; max-width: 140px;'>CASE-A01</td><td class='sticky-col' style='left: 140px; width: 140px; min-width: 140px; max-width: 140px;'>products</td><td class='sticky-col' style='left: 280px; width: 110px; min-width: 110px; max-width: 110px;'>INSERT</td><td class='sticky-col' style='left: 390px; width: 150px; min-width: 150px; max-width: 150px;'>商品登録</td><td data-group='products'><span class='change detail-hover' data-detail='CASE-A01 / product_name
operation: INSERT
trigger: 商品登録
詳細は後で追記'><span class='after added'>Widget-A</span></span></td><td data-group='products'><span class='change detail-hover' data-detail='CASE-A01 / price
operation: INSERT
trigger: 商品登録
詳細は後で追記'><span class='after added'>300</span></span></td><td data-group='products'><span class='change detail-hover' data-detail='CASE-A01 / stock
operation: INSERT
trigger: 商品登録
詳細は後で追記'><span class='after added'>50</span></span></td><td class='empty' data-group='products'></td><td class='empty' data-group='shipments'></td><td class='empty' data-group='shipments'></td><td class='empty' data-group='shipments'></td><td class='empty' data-group='subscriptions'></td><td class='empty' data-group='subscriptions'></td><td class='empty' data-group='subscriptions'></td></tr><tr class='op-update' data-table='shipments'><td class='sticky-col' style='left: 0px; width: 140px; min-width: 140px; max-width: 140px;'>CASE-A02</td><td class='sticky-col' style='left: 140px; width: 140px; min-width: 140px; max-width: 140px;'>shipments</td><td class='sticky-col' style='left: 280px; width: 110px; min-width: 110px; max-width: 110px;'>UPDATE</td><td class='sticky-col' style='left: 390px; width: 150px; min-width: 150px; max-width: 150px;'>出荷処理</td><td class='empty' data-group='products'></td><td class='empty' data-group='products'></td><td class='empty' data-group='products'></td><td class='empty' data-group='products'></td><td data-group='shipments'><span class='change detail-hover' data-detail='CASE-A02 / shipment_status
operation: UPDATE
trigger: 出荷処理
詳細は後で追記'><span class='before'>READY</span><span class='arrow'>→</span><span class='after changed'>SHIPPED</span></span></td><td data-group='shipments'><span class='change detail-hover' data-detail='CASE-A02 / shipped_at
operation: UPDATE
trigger: 出荷処理
詳細は後で追記'><span class='after added'>2026-02-03</span></span></td><td class='empty' data-group='shipments'></td><td class='empty' data-group='subscriptions'></td><td class='empty' data-group='subscriptions'></td><td class='empty' data-group='subscriptions'></td></tr><tr class='op-update' data-table='subscriptions'><td class='sticky-col' style='left: 0px; width: 140px; min-width: 140px; max-width: 140px;'>CASE-A03</td><td class='sticky-col' style='left: 140px; width: 140px; min-width: 140px; max-width: 140px;'>subscriptions</td><td class='sticky-col' style='left: 280px; width: 110px; min-width: 110px; max-width: 110px;'>UPDATE</td><td class='sticky-col' style='left: 390px; width: 150px; min-width: 150px; max-width: 150px;'>契約更新</td><td class='empty' data-group='products'></td><td class='empty' data-group='products'></td><td class='empty' data-group='products'></td><td class='empty' data-group='products'></td><td class='empty' data-group='shipments'></td><td class='empty' data-group='shipments'></td><td class='empty' data-group='shipments'></td><td data-group='subscriptions'><span class='change detail-hover' data-detail='CASE-A03 / plan_code
operation: UPDATE
trigger: 契約更新
詳細は後で追記'><span class='before'>BASIC</span><span class='arrow'>→</span><span class='after changed'>PRO</span></span></td><td data-group='subscriptions'><span class='change detail-hover' data-detail='CASE-A03 / renewed_at
operation: UPDATE
trigger: 契約更新
詳細は後で追記'><span class='after added'>2026-02-04</span></span></td><td data-group='subscriptions'><span class='change detail-hover' data-detail='CASE-A03 / next_billing
operation: UPDATE
trigger: 契約更新
詳細は後で追記'><span class='after added'>2026-03-04</span></span></td></tr><tr class='op-delete' data-table='products'><td class='sticky-col' style='left: 0px; width: 140px; min-width: 140px; max-width: 140px;'>CASE-A04</td><td class='sticky-col' style='left: 140px; width: 140px; min-width: 140px; max-width: 140px;'>products</td><td class='sticky-col' style='left: 280px; width: 110px; min-width: 110px; max-width: 110px;'>DELETE</td><td class='sticky-col' style='left: 390px; width: 150px; min-width: 150px; max-width: 150px;'>商品廃止</td><td class='empty' data-group='products'></td><td class='empty' data-group='products'></td><td class='empty' data-group='products'></td><td data-group='products'><span class='change detail-hover' data-detail='CASE-A04 / deleted_flag
operation: DELETE
trigger: 商品廃止
詳細は後で追記'><span class='before'>0</span><span class='arrow'>→</span><span class='after changed'>1</span></span></td><td class='empty' data-group='shipments'></td><td class='empty' data-group='shipments'></td><td class='empty' data-group='shipments'></td><td class='empty' data-group='subscriptions'></td><td class='empty' data-group='subscriptions'></td><td class='empty' data-group='subscriptions'></td></tr><tr class='op-update' data-table='shipments'><td class='sticky-col' style='left: 0px; width: 140px; min-width: 140px; max-width: 140px;'>CASE-A05</td><td class='sticky-col' style='left: 140px; width: 140px; min-width: 140px; max-width: 140px;'>shipments</td><td class='sticky-col' style='left: 280px; width: 110px; min-width: 110px; max-width: 110px;'>UPDATE</td><td class='sticky-col' style='left: 390px; width: 150px; min-width: 150px; max-width: 150px;'>配送遅延</td><td class='empty' data-group='products'></td><td class='empty' data-group='products'></td><td class='empty' data-group='products'></td><td class='empty' data-group='products'></td><td class='empty' data-group='shipments'></td><td class='empty' data-group='shipments'></td><td data-group='shipments'><span class='change detail-hover' data-detail='CASE-A05 / delay_reason
operation: UPDATE
trigger: 配送遅延
詳細は後で追記'><span class='after added'>WEATHER</span></span></td><td class='empty' data-group='subscriptions'></td><td class='empty' data-group='subscriptions'></td><td class='empty' data-group='subscriptions'></td></tr>
        </tbody>
      </table>
    </div>
  </div>
  <script>
    const tableFilter = document.getElementById('tableFilter');
    if (tableFilter) {
      const changeGroupHeader = document.getElementById('changeGroupHeader');
      const groupHeaderCells = document.querySelectorAll('th.group-header[data-group]');
      const columnCells = document.querySelectorAll('th.sticky-top-3[data-group], td[data-group]');
      tableFilter.addEventListener('change', () => {
        const value = tableFilter.value;
        document.querySelectorAll('tbody tr').forEach((row) => {
          const table = row.getAttribute('data-table') || '';
          row.style.display = (value === '' || table === value) ? '' : 'none';
        });

        const visibleGroups = new Map();
        groupHeaderCells.forEach((th) => {
          const group = th.getAttribute('data-group') || '';
          const count = parseInt(th.getAttribute('data-count') || '0', 10);
          const visible = (value === '' || group === value);
          th.style.display = visible ? '' : 'none';
          if (visible) {
            visibleGroups.set(group, count);
            th.setAttribute('colspan', String(count));
          }
        });

        columnCells.forEach((cell) => {
          const group = cell.getAttribute('data-group') || '';
          const visible = (value === '' || group === value);
          cell.style.display = visible ? '' : 'none';
        });

        if (changeGroupHeader) {
          let total = 0;
          visibleGroups.forEach((count) => { total += count; });
          if (value === '') {
            total = parseInt(changeGroupHeader.getAttribute('data-count') || '0', 10);
          }
          changeGroupHeader.setAttribute('colspan', String(total));
        }
      });
    }
  </script>
</body>
</html>
